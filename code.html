<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.0/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.17.0/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.0/dist/index.js"></script><script>(e=>{window.WebFontConfig={custom:{families:["KaTeX_AMS","KaTeX_Caligraphic:n4,n7","KaTeX_Fraktur:n4,n7","KaTeX_Main:n4,n7,i4,i7","KaTeX_Math:i4,i7","KaTeX_Script","KaTeX_SansSerif:n4,n7,i4","KaTeX_Size1","KaTeX_Size2","KaTeX_Size3","KaTeX_Size4","KaTeX_Typewriter"]},active:()=>{e().refreshHook.call()}}})(()=>window.markmap)</script><script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" defer></script><script>(()=>{setTimeout(()=>{const{markmap:q,mm:v}=window,j=new q.Toolbar;j.attach(v);const we=j.render();we.setAttribute("style","position:absolute;bottom:20px;right:20px"),document.body.append(we)})})()</script><script>((f,d,h,u)=>{const g=f();window.mm=g.Markmap.create("svg#mindmap",(d||g.deriveOptions)(u),h)})(()=>window.markmap,null,{"content":"dify代码移植","children":[{"content":"数据库","children":[{"content":"表结构","children":[{"content":"dify修改点:","children":[{"content":"models/dataset.py 存储数据的表结构","children":[],"payload":{"lines":"8,9"}},{"content":"models/task.py 任务信息的表结构","children":[],"payload":{"lines":"9,11"}}],"payload":{"lines":"7,8"}}],"payload":{"lines":"6,7"}},{"content":"elasticsearch","children":[{"content":"ragflow 涉及文件:","children":[{"content":"conf/service_conf.yaml 配置","children":[],"payload":{"lines":"13,14"}},{"content":"conf/mapping.json 索引","children":[],"payload":{"lines":"14,15"}},{"content":"rag/utils/es_conn.py: ES连接及查询更新等操作.","children":[],"payload":{"lines":"15,16"}},{"content":"api/apps/document_app.py 解析后的文本管理","children":[],"payload":{"lines":"16,17"}},{"content":"api/apps/dataset_api.py 分块文本的管理","children":[],"payload":{"lines":"17,18"}},{"content":"api/apps/system_app.py: 数据库状态管理","children":[],"payload":{"lines":"18,19"}},{"content":"rag/svr/task_executor.py: 数据库初始化及向量化等某些耗时的数据库任务","children":[],"payload":{"lines":"19,21"}}],"payload":{"lines":"12,13"}},{"content":"dify修改点:","children":[{"content":"configs/middleware/__init__.py  配置","children":[],"payload":{"lines":"22,23"}},{"content":"core/rag/datasource/vdb/elasticsearch/elasticsearch_vector.py ES连接及查询更新、入库等.","children":[],"payload":{"lines":"23,25"}}],"payload":{"lines":"21,22"}}],"payload":{"lines":"11,12"}},{"content":"minio:","children":[{"content":"raglow 涉及文件:","children":[{"content":"rag/utils/minio_conn.py: MinIO连接及查询更新等操作","children":[],"payload":{"lines":"27,28"}},{"content":"api/apps/file_app.py: 原始文档管理","children":[],"payload":{"lines":"28,29"}},{"content":"api/apps/document_app.py: 解析后的文本管理","children":[],"payload":{"lines":"29,30"}},{"content":"api/apps/dataset_api.py: 分块文本的管理","children":[],"payload":{"lines":"30,31"}},{"content":"api/apps/system_app.py: 数据库状态管理","children":[],"payload":{"lines":"31,32"}},{"content":"api/db/services/task_service.py 文件检索","children":[],"payload":{"lines":"32,33"}},{"content":"rag/svr/task_executor.py 数据库初始化及向量化等某些耗时的数据库任务","children":[],"payload":{"lines":"33,35"}}],"payload":{"lines":"26,27"}},{"content":"dify修改点:","children":[{"content":"models/source.py","children":[],"payload":{"lines":"36,37"}},{"content":"models/dataset.py","children":[],"payload":{"lines":"37,39"}}],"payload":{"lines":"35,36"}}],"payload":{"lines":"25,26"}},{"content":"redis","children":[{"content":"raglow 涉及文件:","children":[{"content":"api/apps/system_app.py: 数据库状态管理","children":[],"payload":{"lines":"41,42"}},{"content":"api/db/services/task_service.py 队列任务管理","children":[],"payload":{"lines":"42,43"}},{"content":"rag/svr/task_executor.py 任务管理","children":[],"payload":{"lines":"43,44"}},{"content":"rag/svr/cache_file_svr.py 文件缓存","children":[],"payload":{"lines":"44,45"}},{"content":"rag/utils/redis_conn.py redis连接","children":[],"payload":{"lines":"45,46"}},{"content":"rag/nlp/synonym.py 实体映射关系","children":[],"payload":{"lines":"46,47"}},{"content":"api/db/services/document_service.py celery任务的信息","children":[],"payload":{"lines":"47,49"}}],"payload":{"lines":"40,41"}},{"content":"dify修改点:","children":[{"content":".env 数据库配置","children":[],"payload":{"lines":"50,51"}},{"content":"core/app/apps/base_app_queue_manager.py 队列任务管理","children":[],"payload":{"lines":"51,52"}},{"content":"core/embedding/cached_embedding.py  embedding缓存","children":[],"payload":{"lines":"52,53"}},{"content":"core/indexing_runner.py  索引缓存","children":[],"payload":{"lines":"53,55"}}],"payload":{"lines":"49,50"}}],"payload":{"lines":"39,40"}}],"payload":{"lines":"2,3"}},{"content":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathcolor=\"red\"><mtext>文档解析分块</mtext></mstyle></mrow><annotation encoding=\"application/x-tex\">\\color{red}{文档解析分块}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\" style=\"color:red;\"><span class=\"mord cjk_fallback\" style=\"color:red;\">文档解析分块</span></span></span></span></span>","children":[{"content":"ragflow 涉及文件","children":[{"content":"deepdoc","children":[],"payload":{"lines":"64,66"}}],"payload":{"lines":"63,64"}},{"content":"dify 修改点","children":[{"content":"core/indexing_runner.py","children":[],"payload":{"lines":"67,68"}},{"content":"core/rag/extractor 文本抽取","children":[],"payload":{"lines":"68,69"}},{"content":"core/rag/index_processor 建立索引","children":[],"payload":{"lines":"69,71"}}],"payload":{"lines":"66,67"}}],"payload":{"lines":"55,56"}},{"content":"rag部分","children":[{"content":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathcolor=\"red\"><mtext>分词</mtext></mstyle></mrow><annotation encoding=\"application/x-tex\">\\color{red}{分词}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\" style=\"color:red;\"><span class=\"mord cjk_fallback\" style=\"color:red;\">分词</span></span></span></span></span> (2天)","children":[{"content":"raglow涉及文件","children":[{"content":"rag/nlp/rag_tokenizer.py 分词算法","children":[],"payload":{"lines":"74,75"}},{"content":"rag/res/huqie.txt  分词表","children":[],"payload":{"lines":"75,76"}},{"content":"rag/res/huqie.txt.trie 分词查询树","children":[],"payload":{"lines":"76,78"}}],"payload":{"lines":"73,74"}},{"content":"dify 修改点","children":[{"content":"core/rag/datasource/keyword 新增huqie分词","children":[],"payload":{"lines":"79,81"}}],"payload":{"lines":"78,79"}}],"payload":{"lines":"72,73"}},{"content":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathcolor=\"red\"><mtext>停词过滤</mtext></mstyle></mrow><annotation encoding=\"application/x-tex\">\\color{red}{停词过滤}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\" style=\"color:red;\"><span class=\"mord cjk_fallback\" style=\"color:red;\">停词过滤</span></span></span></span></span>(2天)","children":[{"content":"ragflow涉及文件","children":[{"content":"rag/nlp/term_weight.py 词的权重","children":[],"payload":{"lines":"83,85"}}],"payload":{"lines":"82,83"}},{"content":"dify 修改点","children":[{"content":"core/rag/cleaner 新增stopwords","children":[],"payload":{"lines":"86,87"}},{"content":"core/rag/cleaner/clean_processor.py 杂余文字符号清理","children":[],"payload":{"lines":"87,89"}}],"payload":{"lines":"85,86"}}],"payload":{"lines":"81,82"}},{"content":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathcolor=\"red\"><mtext>关键词抽取及实体链接</mtext></mstyle></mrow><annotation encoding=\"application/x-tex\">\\color{red}{关键词抽取及实体链接}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\" style=\"color:red;\"><span class=\"mord cjk_fallback\" style=\"color:red;\">关键词抽取及实体链接</span></span></span></span></span> (2天)","children":[{"content":"ragflow 涉及文件","children":[{"content":"rag/nlp/term_weight.py","children":[],"payload":{"lines":"91,92"}},{"content":"rag/res/ner.json","children":[],"payload":{"lines":"92,94"}}],"payload":{"lines":"90,91"}},{"content":"dify 修改点","children":[{"content":"core/rag/datasource/entity 新增","children":[],"payload":{"lines":"95,97"}}],"payload":{"lines":"94,95"}}],"payload":{"lines":"89,90"}},{"content":"知识图谱(3天)","children":[{"content":"ragflow涉及文件","children":[{"content":"graphrag 基于微软graphrag修改","children":[],"payload":{"lines":"99,100"}},{"content":"rag/app/knowledge_graph.py  基于graphrag生成文本的chunks.","children":[],"payload":{"lines":"100,101"}},{"content":"api/settings.py","children":[],"payload":{"lines":"101,103"}}],"payload":{"lines":"98,99"}},{"content":"dify 修改点","children":[{"content":"core/rag/extractor 新增graphrag","children":[],"payload":{"lines":"104,106"}}],"payload":{"lines":"103,104"}}],"payload":{"lines":"97,98"}},{"content":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathcolor=\"red\"><mtext>向量嵌入</mtext></mstyle></mrow><annotation encoding=\"application/x-tex\">\\color{red}{向量嵌入}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\" style=\"color:red;\"><span class=\"mord cjk_fallback\" style=\"color:red;\">向量嵌入</span></span></span></span></span>(2天)","children":[{"content":"ragflow 涉及文件","children":[{"content":"rag/llm/__init__.py","children":[],"payload":{"lines":"108,109"}},{"content":"rag/llm/embedding_model.py  嵌入模型","children":[],"payload":{"lines":"109,110"}},{"content":"api/db/services/llm_service.py llm服务","children":[],"payload":{"lines":"110,111"}},{"content":"api/apps/llm_app.py  llm应用","children":[],"payload":{"lines":"111,113"}}],"payload":{"lines":"107,108"}},{"content":"dify修改点","children":[{"content":"core/indexing_runner.py 查询","children":[],"payload":{"lines":"114,115"}},{"content":"core/rag/docstore/dataset_docstore.py 向量存储","children":[],"payload":{"lines":"115,116"}},{"content":"core/rag/datasource/retrieval_service.py  向量检索","children":[],"payload":{"lines":"116,118"}}],"payload":{"lines":"113,114"}}],"payload":{"lines":"106,107"}},{"content":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathcolor=\"red\"><mtext>问句改写</mtext></mstyle></mrow><annotation encoding=\"application/x-tex\">\\color{red}问句改写</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord cjk_fallback\" style=\"color:red;\">问句改写</span></span></span></span>(0.5天)","children":[{"content":"ragflow涉及文件","children":[{"content":"api/db/services/dialog_service.py","children":[],"payload":{"lines":"120,122"}}],"payload":{"lines":"119,120"}},{"content":"dify 修改点","children":[{"content":"core/rag  增加rewrite","children":[],"payload":{"lines":"123,125"}}],"payload":{"lines":"122,123"}}],"payload":{"lines":"118,119"}},{"content":"检索召回(3天)","children":[{"content":"ragflow涉及文件","children":[{"content":"api/apps/api_app.py: retrieval() 检索召回入口","children":[],"payload":{"lines":"127,128"}},{"content":"api/settings.py 检索方式设置","children":[],"payload":{"lines":"128,129"}},{"content":"rag/nlp/search.py   ES检索","children":[],"payload":{"lines":"129,130"}},{"content":"graphrag/search.py   知识图谱检索","children":[],"payload":{"lines":"130,131"}},{"content":"api/apps/chunk_app.py  检索召回测试","children":[],"payload":{"lines":"131,133"}}],"payload":{"lines":"126,127"}},{"content":"dify 修改点","children":[{"content":"core/rag/datasource/retrieval_service.py","children":[],"payload":{"lines":"134,135"}},{"content":"core/rag/retrieval 需新增graph_search","children":[],"payload":{"lines":"135,137"}}],"payload":{"lines":"133,134"}}],"payload":{"lines":"125,126"}},{"content":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathcolor=\"red\"><mtext>文档重排</mtext></mstyle></mrow><annotation encoding=\"application/x-tex\">\\color{red}文档重排</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord cjk_fallback\" style=\"color:red;\">文档重排</span></span></span></span>(1天)","children":[{"content":"ragflow 涉及文件","children":[{"content":"api/db/services/llm_service.py rerank模型配置","children":[],"payload":{"lines":"139,140"}},{"content":"rag/nlp/search.py 重排调用","children":[],"payload":{"lines":"140,141"}},{"content":"rag/llm/rerank_model.py 重排具体实现","children":[],"payload":{"lines":"141,143"}}],"payload":{"lines":"138,139"}},{"content":"dify修改点","children":[{"content":"core/rag/rerank","children":[],"payload":{"lines":"144,145"}},{"content":"core/rag/data_post_processor/data_post_processor.py","children":[],"payload":{"lines":"145,146"}},{"content":"core/rag/retrieval/dataset_retrieval.py","children":[],"payload":{"lines":"146,147"}},{"content":"core/rag/datasource/retrieval_service.py","children":[],"payload":{"lines":"147,149"}}],"payload":{"lines":"143,144"}}],"payload":{"lines":"137,138"}},{"content":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathcolor=\"red\"><mrow><mtext>模板</mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>t</mi><mi>s</mi></mrow></mstyle></mrow><annotation encoding=\"application/x-tex\">\\color{red}{模板prompts}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord\" style=\"color:red;\"><span class=\"mord cjk_fallback\" style=\"color:red;\">模板</span><span class=\"mord mathnormal\" style=\"color:red;\">p</span><span class=\"mord mathnormal\" style=\"color:red;\">ro</span><span class=\"mord mathnormal\" style=\"color:red;\">m</span><span class=\"mord mathnormal\" style=\"color:red;\">pt</span><span class=\"mord mathnormal\" style=\"color:red;\">s</span></span></span></span></span>(1天)","children":[{"content":"ragflow 涉及文件","children":[{"content":"agent/component/categorize.py   分类的prompts","children":[],"payload":{"lines":"151,152"}},{"content":"agent/component/keyword.py      关键词的prompts","children":[],"payload":{"lines":"152,153"}},{"content":"agent/component/relevant.py","children":[],"payload":{"lines":"153,154"}},{"content":"agent/component/rewrite.py","children":[],"payload":{"lines":"154,155"}},{"content":"...","children":[],"payload":{"lines":"155,157"}}],"payload":{"lines":"150,151"}},{"content":"dify 修改点","children":[{"content":"core/prompt/prompt_templates","children":[],"payload":{"lines":"158,159"}}],"payload":{"lines":"157,158"}}],"payload":{"lines":"149,150"}}],"payload":{"lines":"71,72"}}],"payload":{"lines":"0,1"}},null)</script>
</body>
</html>
